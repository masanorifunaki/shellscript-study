# ShellScript 学習用

## 3章
### No.029
```bash
# 後方参照
# nオプションは、処理後のパターンスペースの内容を出力しないようにするオプション
# pフラグ、マッチした場合のみパターンスペースを出力する。
# <titel>タグの中身をパターンマッチで抽出してファイルに出力している。
sed -n 's/^.*<title>\(.*\)<\/title>.*$/\1/p' $htmlfile > output/${fname}.txt
```
```bash
# ファイルの拡張子を取り除きたい時に使う
fname=$(basename "$htmlfile" .html)
```
### No.030
```bash
# 4日前から2日前までに更新されたファイル一覧を表示する
# -mtime オプション
# -mtime -n nより未来 4日前から未来
# -mtime +n nより過去 2日前から過去
# -mtime n+1 n+1前から、n日前まで
# FreeBSDでは、-mtime +nのよきに端数の時間を切り上げるため、
# -mtime +1で「1日前よりも過去」となる。
find $logdir -name "*.sh" -mtime -4 -mtime +1 -print
```
### FreeBSD
* 使い勝手がUNIXっぽい
* タダで使える
* 中身が公開されている（オープンソース）
#### UNIXとLinuxの違い
UNIXが師匠でLinuxが弟子

### No.031
```bash
# 最終変更日時が1年以上前の古いファイルを削除する
# xargsコマンド主な使い方は、
# findコマンドで特定の条件にマッチするファイルリストを出力し、
# それをパイプでxargsコマンドが受け取って処理する。
# rmコマンド
# -f オプション 該当ファイルが1つもないときにエラーとならないようにする
# -v オプション 削除したファイル名を表示する
# ファイル名に空白文字（スペース）を含む場合は、エラーとなるため
# 文字列の区切りに空白ではなく、ヌル文字が使われているとみなす、
# オプションを使う
# find -print0 | xargs -0
# find $logdir -name "*.log" -mtime +364 -print0 | xargs -0 rm -fv
find $logdir -name "*.log" -mtime +364 -print | xargs rm -fv #1
```
#### パッチ（patch）
ソフトに変更を加えるために用意された、後付けのプログラムのこと
* おかしなところを直す
* ソフトをパワーアップさせる

### No.032
```bash
# 拡張子.shのファイルから、"bin"という文字列を検索
# 対象のファイルに/dev/nullを加えることで、grepコマンドの出力に必ず
# ファイル名を含むようにするための処理になる。
# grepコマンドでは複数のファイルを対象とした場合、先頭にファイル名をつけて
# マッチした行を出力する。
find "$dir" -name "*.sh" -print | xargs grep "bin" /dev/null #1
```
#### ARG_MAX定数
UNIXでは、コマンドライン引数の上限値はARG_MAX定数で決め打ちされている。
`xargs`コマンドは、ARG_MAXの値を超えないように引数を適度に区切って、指定されたコマンドを実行する。

### No.033
```bash

bak_filename="${file}.$(date '+%Y%m%d')" #1

# すでにhoge.20170220 などがあった場合は、秒まで入れて
# バックアップファイルを作成する
if [[ -e $bak_filename ]]; then
    bak_filename="${file}.$(date '+%Y%m%d%H%M.%S')" #2
fi

cp -v "$file" "$bak_filename" #3
```

#### dateコマンド
dateコマンドは引数+で始まる場合、現在の時刻（日付）を指示して表示できる。
引数としてフィールド名を与えることで、年月日や時分秒を自由に組み合わせて文字列を作れる。
##### dateコマンドのフィールド
* %Y 年(1970~)
* %y 年の下2桁(00~99)
* %m 月(01~12)
* %d日(01~31)
* %H時(00~23)
* %M 分(00~59)
* %S 秒(00~59)
